***************
*** 149,179 ****
  	.num_links = ARRAY_SIZE(smdk_dai),
  };
  
- static struct platform_device *smdk_snd_device;
  
- static int __init smdk_audio_init(void)
  {
  	int ret;
  
- 	smdk_snd_device = platform_device_alloc("soc-audio", -1);
- 	if (!smdk_snd_device)
- 		return -ENOMEM;
  
- 	platform_set_drvdata(smdk_snd_device, &smdk);
- 
- 	ret = platform_device_add(smdk_snd_device);
  	if (ret)
- 		platform_device_put(smdk_snd_device);
  
  	return ret;
  }
- module_init(smdk_audio_init);
  
- static void __exit smdk_audio_exit(void)
  {
- 	platform_device_unregister(smdk_snd_device);
  }
- module_exit(smdk_audio_exit);
  
  MODULE_DESCRIPTION("ALSA SoC SMDK WM8994");
  MODULE_LICENSE("GPL");
--- 149,189 ----
  	.num_links = ARRAY_SIZE(smdk_dai),
  };
  
  
+ static int __devinit smdk_audio_probe(struct platform_device *pdev)
  {
  	int ret;
+ 	struct snd_soc_card *card = &smdk;
  
+ 	card->dev = &pdev->dev;
+ 	ret = snd_soc_register_card(card);
  
  	if (ret)
+ 		dev_err(&pdev->dev, "snd_soc_register_card() failed:%d\n", ret);
  
  	return ret;
  }
  
+ static int __devexit smdk_audio_remove(struct platform_device *pdev)
  {
+ 	struct snd_soc_card *card = platform_get_drvdata(pdev);
+ 
+ 	snd_soc_unregister_card(card);
+ 
+ 	return 0;
  }
+ 
+ static struct platform_driver smdk_audio_driver = {
+ 	.driver		= {
+ 		.name	= "smdk-audio",
+ 		.owner	= THIS_MODULE,
+ 	},
+ 	.probe		= smdk_audio_probe,
+ 	.remove		= __devexit_p(smdk_audio_remove),
+ };
+ 
+ module_platform_driver(smdk_audio_driver);
  
  MODULE_DESCRIPTION("ALSA SoC SMDK WM8994");
  MODULE_LICENSE("GPL");
+ MODULE_ALIAS("platform:smdk-audio");
