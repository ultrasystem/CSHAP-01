***************
*** 457,466 ****
  
  		/* disable, just in case */
  		fmxr(FPEXC, fmrx(FPEXC) & ~FPEXC_EN);
  	}
  
  	/* clear any information we had about last context state */
- 	memset(vfp_current_hw_state, 0, sizeof(vfp_current_hw_state));
  
  	return 0;
  }
--- 457,472 ----
  
  		/* disable, just in case */
  		fmxr(FPEXC, fmrx(FPEXC) & ~FPEXC_EN);
+ 	} else if (vfp_current_hw_state[ti->cpu]) {
+ #ifndef CONFIG_SMP
+ 		fmxr(FPEXC, fpexc | FPEXC_EN);
+ 		vfp_save_state(vfp_current_hw_state[ti->cpu], fpexc);
+ 		fmxr(FPEXC, fpexc);
+ #endif
  	}
  
  	/* clear any information we had about last context state */
+ 	vfp_current_hw_state[ti->cpu] = NULL;
  
  	return 0;
  }
***************
*** 713,720 ****
  			if ((fmrx(MVFR1) & 0x000fff00) == 0x00011100)
  				elf_hwcap |= HWCAP_NEON;
  #endif
  			if ((fmrx(MVFR1) & 0xf0000000) == 0x10000000)
  				elf_hwcap |= HWCAP_VFPv4;
  		}
  	}
  	return 0;
--- 719,728 ----
  			if ((fmrx(MVFR1) & 0x000fff00) == 0x00011100)
  				elf_hwcap |= HWCAP_NEON;
  #endif
+ #ifdef CONFIG_VFPv3
  			if ((fmrx(MVFR1) & 0xf0000000) == 0x10000000)
  				elf_hwcap |= HWCAP_VFPv4;
+ #endif
  		}
  	}
  	return 0;
